--###############################################################
--###############################################################
--###############################################################
--Boas-vindas ao Kau√£ executor
--Um executor novo por√©m pode ser muito melhor que executores normaisüòº
--"m-m-mas como assim?"
--Bom saiba que por ser um script totalmente feito...
--no roblox pode ser que execute tudo!
--se n√£o executou √© porque que o roblox deve ter atualizado algo
--ent√£o pesquise a atualiza√ß√£o do "executor"
--
--VERS√ÉO ----------> 0.1 Beta
--bom talvez eu esque√ßa de botar aqui a vers√£o mas...
--t√° na cara o sctript ent√£o ser√° dificil esquecer...
--###############################################################
--###############################################################
--###############################################################
--O SCRIPT EST√Å ABAIXO
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì
--           ‚Üì


local Player = game:GetService("Players").LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local TextService = game:GetService("TextService")

-- Verifica√ß√£o de ambiente
if not RunService:IsClient() and not RunService:IsStudio() then
    warn("Executor s√≥ funciona no cliente!")
    return
end

-- Fun√ß√£o para salvar o estado do executor
local function SaveExecutorState(code, position, minimized, outputLog)
    local stateFolder = Instance.new("Folder")
    stateFolder.Name = "KauaExecutorState"
    
    local codeValue = Instance.new("StringValue")
    codeValue.Name = "Code"
    codeValue.Value = code
    codeValue.Parent = stateFolder
    
    local positionValue = Instance.new("Vector3Value")
    positionValue.Name = "Position"
    positionValue.Value = Vector3.new(position.X.Scale, position.X.Offset, position.Y.Offset)
    positionValue.Parent = stateFolder
    
    local minimizedValue = Instance.new("BoolValue")
    minimizedValue.Name = "Minimized"
    minimizedValue.Value = minimized
    minimizedValue.Parent = stateFolder
    
    local outputValue = Instance.new("StringValue")
    outputValue.Name = "OutputLog"
    outputValue.Value = outputLog
    outputValue.Parent = stateFolder
    
    local oldState = CoreGui:FindFirstChild("KauaExecutorState")
    if oldState then
        oldState:Destroy()
    end
    
    stateFolder.Parent = CoreGui
end

-- Fun√ß√£o para carregar o estado do executor
local function LoadExecutorState()
    local stateFolder = CoreGui:FindFirstChild("KauaExecutorState")
    if not stateFolder then return nil end
    
    local code = stateFolder:FindFirstChild("Code")
    local position = stateFolder:FindFirstChild("Position")
    local minimized = stateFolder:FindFirstChild("Minimized")
    local outputLog = stateFolder:FindFirstChild("OutputLog")
    
    if code and position and minimized then
        local positionUDim = UDim2.new(
            position.Value.X,
            position.Value.Y,
            0,
            position.Value.Z
        )
        
        return {
            code = code.Value,
            position = positionUDim,
            minimized = minimized.Value,
            outputLog = outputLog and outputLog.Value or ""
        }
    end
    
    return nil
end

-- Remove GUIs antigas
local existingGui = Player.PlayerGui:FindFirstChild("KauaExecutorUltimate")
if existingGui then
    existingGui:Destroy()
end

-- Cria a GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KauaExecutorUltimate"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = Player:WaitForChild("PlayerGui")

-- Carrega o estado salvo
local savedState = LoadExecutorState()

-- Janela principal
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 600, 0, 500) -- Aumentado para caber o output

if savedState then
    MainFrame.Position = savedState.position
else
    MainFrame.Position = UDim2.new(0.5, -300, 0.5, -250) -- Ajustado para novo tamanho
end

MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
MainFrame.BorderColor3 = Color3.fromRGB(50, 50, 50)
MainFrame.BorderSizePixel = 1
MainFrame.Active = true
MainFrame.ClipsDescendants = true
MainFrame.Parent = ScreenGui

-- T√≠tulo com anima√ß√£o RGB
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(0, 200, 0, 25)
Title.Position = UDim2.new(0, 10, 0, 5)
Title.BackgroundTransparency = 1
Title.Font = Enum.Font.GothamBold
Title.Text = "Kau√£ Executor ULTIMATE"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 16
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = MainFrame

local hue = 0
RunService.Heartbeat:Connect(function(deltaTime)
    hue = (hue + deltaTime * 0.5) % 1
    Title.TextColor3 = Color3.fromHSV(hue, 0.8, 1)
end)

-- Bot√£o de fechar
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 25, 0, 25)
CloseButton.Position = UDim2.new(1, -30, 0, 5)
CloseButton.BackgroundColor3 = Color3.fromRGB(255, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Font = Enum.Font.GothamBold
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.TextSize = 14
CloseButton.Parent = MainFrame

-- Bot√£o de minimizar/restaurar
local MinimizeButton = Instance.new("TextButton")
MinimizeButton.Name = "MinimizeButton"
MinimizeButton.Size = UDim2.new(0, 25, 0, 25)
MinimizeButton.Position = UDim2.new(1, -60, 0, 5)
MinimizeButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
MinimizeButton.BorderSizePixel = 0
MinimizeButton.Font = Enum.Font.GothamBold
MinimizeButton.Text = "_"
MinimizeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MinimizeButton.TextSize = 14
MinimizeButton.Parent = MainFrame

local isMinimized = false
local originalSize = MainFrame.Size
local minimizedSize = UDim2.new(0, 600, 0, 35)
local elementsToHide = {}

-- Fun√ß√£o para minimizar/restaurar
local function ToggleMinimize()
    isMinimized = not isMinimized
    
    if isMinimized then
        for _, child in pairs(MainFrame:GetChildren()) do
            if child ~= Title and child ~= CloseButton and child ~= MinimizeButton then
                child.Visible = false
                table.insert(elementsToHide, child)
            end
        end
        MainFrame.Size = minimizedSize
        MinimizeButton.Text = "+"
    else
        for _, child in pairs(elementsToHide) do
            child.Visible = true
        end
        elementsToHide = {}
        MainFrame.Size = originalSize
        MinimizeButton.Text = "_"
    end
    
    SaveExecutorState(CodeTextBox.Text, MainFrame.Position, isMinimized, OutputText.Text)
end

MinimizeButton.MouseButton1Click:Connect(ToggleMinimize)

-- Editor de c√≥digo
local CodeEditorScrollingFrame = Instance.new("ScrollingFrame")
CodeEditorScrollingFrame.Name = "CodeEditorScrollingFrame"
CodeEditorScrollingFrame.Size = UDim2.new(1, -20, 0.6, -40) -- Ajustado para caber o output
CodeEditorScrollingFrame.Position = UDim2.new(0, 10, 0, 35)
CodeEditorScrollingFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
CodeEditorScrollingFrame.BorderSizePixel = 0
CodeEditorScrollingFrame.ScrollBarThickness = 8
CodeEditorScrollingFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
CodeEditorScrollingFrame.Parent = MainFrame

-- N√∫meros de linha
local LineNumbers = Instance.new("TextLabel")
LineNumbers.Name = "LineNumbers"
LineNumbers.Size = UDim2.new(0, 40, 1, 0)
LineNumbers.Position = UDim2.new(0, 0, 0, 0)
LineNumbers.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
LineNumbers.BorderSizePixel = 0
LineNumbers.Font = Enum.Font.Code
LineNumbers.Text = "1"
LineNumbers.TextColor3 = Color3.fromRGB(120, 120, 120)
LineNumbers.TextSize = 14
LineNumbers.TextXAlignment = Enum.TextXAlignment.Right
LineNumbers.TextYAlignment = Enum.TextYAlignment.Top
LineNumbers.AutomaticSize = Enum.AutomaticSize.Y
LineNumbers.Parent = CodeEditorScrollingFrame

-- √Årea de c√≥digo
local CodeTextBox = Instance.new("TextBox")
CodeTextBox.Name = "CodeTextBox"
CodeTextBox.Size = UDim2.new(1, -45, 1, 0)
CodeTextBox.Position = UDim2.new(0, 45, 0, 0)
CodeTextBox.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
CodeTextBox.BorderSizePixel = 0
CodeTextBox.Font = Enum.Font.Code

if savedState and savedState.code then
    CodeTextBox.Text = savedState.code
else
    CodeTextBox.Text = [[-- Bem-vindo ao Kau√£ Executor ULTIMATE!
-- Todos os comandos Lua e Roblox est√£o dispon√≠veis

-- Exemplos b√°sicos:
print("Ol√° mundo!")
print("2 + 2 =", 2+2)

-- Acesse o jogador local:
local player = game:GetService("Players").LocalPlayer
print("Nome do jogador:", player.Name)

-- Crie uma part:
local part = Instance.new("Part")
part.Parent = workspace
part.Position = Vector3.new(0, 10, 0)
part.Anchored = true
print("Part criada:", part)]]
end

CodeTextBox.TextColor3 = Color3.fromRGB(255, 255, 255)
CodeTextBox.TextSize = 14
CodeTextBox.TextXAlignment = Enum.TextXAlignment.Left
CodeTextBox.TextYAlignment = Enum.TextYAlignment.Top
CodeTextBox.MultiLine = true
CodeTextBox.TextWrapped = false
CodeTextBox.ClearTextOnFocus = false
CodeTextBox.AutomaticSize = Enum.AutomaticSize.Y
CodeTextBox.Parent = CodeEditorScrollingFrame

-- Atualizar n√∫meros de linha
local function UpdateLineNumbers()
    local lineCount = 1
    for _ in string.gmatch(CodeTextBox.Text, "\n") do
        lineCount = lineCount + 1
    end
    
    local numbers = ""
    for i = 1, lineCount do
        numbers = numbers .. i .. "\n"
    end
    
    LineNumbers.Text = numbers
    CodeEditorScrollingFrame.CanvasSize = UDim2.new(0, 0, 0, CodeTextBox.TextBounds.Y)
end

CodeTextBox:GetPropertyChangedSignal("Text"):Connect(UpdateLineNumbers)
UpdateLineNumbers()

-- Painel de output
local OutputFrame = Instance.new("Frame")
OutputFrame.Name = "OutputFrame"
OutputFrame.Size = UDim2.new(1, -20, 0.35, -10)
OutputFrame.Position = UDim2.new(0, 10, 0.6, 5)
OutputFrame.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
OutputFrame.BorderSizePixel = 1
OutputFrame.BorderColor3 = Color3.fromRGB(50, 50, 50)
OutputFrame.Parent = MainFrame

local OutputLabel = Instance.new("TextLabel")
OutputLabel.Name = "OutputLabel"
OutputLabel.Size = UDim2.new(1, 0, 0, 20)
OutputLabel.Position = UDim2.new(0, 0, 0, 0)
OutputLabel.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
OutputLabel.Font = Enum.Font.GothamBold
OutputLabel.Text = "OUTPUT:"
OutputLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
OutputLabel.TextSize = 12
OutputLabel.Parent = OutputFrame

local OutputScrolling = Instance.new("ScrollingFrame")
OutputScrolling.Name = "OutputScrolling"
OutputScrolling.Size = UDim2.new(1, 0, 1, -25)
OutputScrolling.Position = UDim2.new(0, 0, 0, 25)
OutputScrolling.BackgroundTransparency = 1
OutputScrolling.ScrollBarThickness = 8
OutputScrolling.AutomaticCanvasSize = Enum.AutomaticSize.Y
OutputScrolling.Parent = OutputFrame

local OutputText = Instance.new("TextLabel")
OutputText.Name = "OutputText"
OutputText.Size = UDim2.new(1, -10, 0, 0)
OutputText.Position = UDim2.new(0, 5, 0, 5)
OutputText.BackgroundTransparency = 1
OutputText.Font = Enum.Font.Code
OutputText.Text = savedState and savedState.outputLog or "-- Output aparecer√° aqui --"
OutputText.TextColor3 = Color3.fromRGB(200, 200, 200)
OutputText.TextSize = 14
OutputText.TextXAlignment = Enum.TextXAlignment.Left
OutputText.TextYAlignment = Enum.TextYAlignment.Top
OutputText.TextWrapped = true
OutputText.AutomaticSize = Enum.AutomaticSize.Y
OutputText.Parent = OutputScrolling

-- Fun√ß√£o para adicionar texto ao output
local function AddToOutput(text, color)
    color = color or Color3.fromRGB(200, 200, 200)
    
    local currentText = OutputText.Text
    if currentText == "-- Output aparecer√° aqui --" then
        currentText = ""
    end
    
    -- Adiciona timestamp
    local timeText = os.date("[%H:%M:%S] ")
    
    OutputText.Text = currentText .. timeText .. tostring(text) .. "\n"
    OutputText.TextColor3 = color
    
    -- Auto-scroll para baixo
    OutputScrolling.CanvasPosition = Vector2.new(0, OutputText.AbsoluteSize.Y)
    
    -- Salva o output
    SaveExecutorState(CodeTextBox.Text, MainFrame.Position, isMinimized, OutputText.Text)
end

-- Bot√£o para limpar output
local ClearOutputButton = Instance.new("TextButton")
ClearOutputButton.Name = "ClearOutputButton"
ClearOutputButton.Size = UDim2.new(0, 80, 0, 20)
ClearOutputButton.Position = UDim2.new(1, -85, 0, 0)
ClearOutputButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
ClearOutputButton.BorderSizePixel = 0
ClearOutputButton.Font = Enum.Font.Gotham
ClearOutputButton.Text = "Limpar Output"
ClearOutputButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ClearOutputButton.TextSize = 12
ClearOutputButton.Parent = OutputFrame

ClearOutputButton.MouseButton1Click:Connect(function()
    OutputText.Text = ""
    SaveExecutorState(CodeTextBox.Text, MainFrame.Position, isMinimized, OutputText.Text)
end)

-- Bot√µes de controle
local ExecuteButton = Instance.new("TextButton")
ExecuteButton.Name = "ExecuteButton"
ExecuteButton.Size = UDim2.new(0, 120, 0, 35)
ExecuteButton.Position = UDim2.new(1, -130, 1, -45)
ExecuteButton.BackgroundColor3 = Color3.fromRGB(50, 150, 50)
ExecuteButton.BorderSizePixel = 0
ExecuteButton.Font = Enum.Font.GothamBold
ExecuteButton.Text = "EXECUTAR (F9)"
ExecuteButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ExecuteButton.TextSize = 14
ExecuteButton.Parent = MainFrame

local ClearButton = Instance.new("TextButton")
ClearButton.Name = "ClearButton"
ClearButton.Size = UDim2.new(0, 120, 0, 35)
ClearButton.Position = UDim2.new(0, 10, 1, -45)
ClearButton.BackgroundColor3 = Color3.fromRGB(150, 50, 50)
ClearButton.BorderSizePixel = 0
ClearButton.Font = Enum.Font.GothamBold
ClearButton.Text = "LIMPAR C√ìDIGO"
ClearButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ClearButton.TextSize = 14
ClearButton.Parent = MainFrame

ClearButton.MouseButton1Click:Connect(function()
    CodeTextBox.Text = ""
    UpdateLineNumbers()
    SaveExecutorState(CodeTextBox.Text, MainFrame.Position, isMinimized, OutputText.Text)
end)

-- Fun√ß√£o loadstring que funciona SEM HTTP
local function CustomLoadString(code)
    local fn, err = loadstring(code)
    if fn then return fn end
    
    local success, result = pcall(function()
        local chunk, loadErr = load(code)
        if chunk then return chunk end
        
        local anonymousFn = assert(load("return function()\n"..code.."\nend"))()
        return anonymousFn
    end)
    
    if success and result then
        return result
    else
        return nil, "Erro ao carregar: "..tostring(result or err)
    end
end

-- Ambiente de execu√ß√£o completo
local function CreateExecutionEnvironment()
    local env = {}
    
    -- Copia todas as fun√ß√µes globais seguras do Lua
    for name, func in pairs(getfenv()) do
        env[name] = func
    end
    
    -- Objetos e servi√ßos do Roblox
    env.game = game
    env.workspace = workspace
    env.script = script
    
    -- Todas as classes de inst√¢ncia do Roblox
    for _, className in pairs({
        "Part", "Model", "Script", "LocalScript", "ModuleScript",
        "Folder", "StringValue", "NumberValue", "BoolValue",
        "ObjectValue", "CFrameValue", "Color3Value", "Vector3Value",
        "BrickColorValue", "IntValue", "RayValue", "Motor",
        "Motor6D", "MotorFeature", "Weld", "WeldConstraint",
        "BasePart", "UnionOperation", "MeshPart", "CornerWedgePart",
        "SpawnLocation", "WedgePart", "Terrain", "Camera",
        "Humanoid", "HumanoidDescription", "Animation", "AnimationTrack",
        "Pose", "Keyframe", "KeyframeSequence", "KeyframeSequenceProvider",
        "AnimationController", "AnimationRigData", "AnimationClip",
        "AnimationClipProvider", "Animator", "AnimationFromVideoCreator",
        "AnimationFromVideoCreatorService", "AnimationFromVideoCreatorUI",
        "AnimationFromVideoCreatorUIService", "AnimationFromVideoCreatorUIServiceClient",
        "AnimationFromVideoCreatorUIServiceServer", "AnimationFromVideoCreatorUIServiceShared",
        "AnimationFromVideoCreatorUIServiceTest", "AnimationFromVideoCreatorUIServiceTestClient",
        "AnimationFromVideoCreatorUIServiceTestServer", "AnimationFromVideoCreatorUIServiceTestShared",
        "AnimationFromVideoCreatorUIServiceTestTest", "AnimationFromVideoCreatorUIServiceTestTestClient",
        "AnimationFromVideoCreatorUIServiceTestTestServer", "AnimationFromVideoCreatorUIServiceTestTestShared"
    }) do
        env[className] = function(...)
            return Instance.new(className, ...)
        end
    end
    
    -- Todas as classes de dados do Roblox
    env.Vector3 = Vector3
    env.Vector2 = Vector2
    env.CFrame = CFrame
    env.UDim2 = UDim2
    env.UDim = UDim
    env.Color3 = Color3
    env.ColorSequence = ColorSequence
    env.ColorSequenceKeypoint = ColorSequenceKeypoint
    env.NumberSequence = NumberSequence
    env.NumberSequenceKeypoint = NumberSequenceKeypoint
    env.Rect = Rect
    env.Region3 = Region3
    env.Region3int16 = Region3int16
    env.Faces = Faces
    env.Axes = Axes
    env.BrickColor = BrickColor
    env.PhysicalProperties = PhysicalProperties
    
    -- Fun√ß√µes matem√°ticas
    env.math = table.clone(math)
    env.math.randomseed = os.time()
    
    -- Fun√ß√µes de tabela
    env.table = table.clone(table)
    
    -- Fun√ß√µes de string
    env.string = table.clone(string)
    
    -- Fun√ß√µes de corrotina
    env.coroutine = table.clone(coroutine)
    
    -- Fun√ß√µes de os
    env.os = {
        time = os.time,
        date = os.date,
        difftime = os.difftime,
        clock = os.clock
    }
    
    -- Fun√ß√µes de debug (seguras)
    env.debug = {
        traceback = debug.traceback,
        info = debug.info,
        getupvalue = debug.getupvalue,
        setupvalue = debug.setupvalue,
        getlocal = debug.getlocal,
        setlocal = debug.setlocal,
        getregistry = debug.getregistry,
        getmetatable = debug.getmetatable,
        setmetatable = debug.setmetatable
    }
    
    -- Todos os servi√ßos do Roblox
    for _, serviceName in pairs({
        "Players", "Workspace", "Lighting", "ReplicatedStorage",
        "ServerScriptService", "ServerStorage", "StarterPack",
        "StarterPlayer", "StarterGui", "SoundService", "Chat",
        "Teams", "TeleportService", "TextService", "MarketplaceService",
        "UserInputService", "ContextActionService", "RunService",
        "GuiService", "HttpService", "CollectionService", "TestService",
        "PathfindingService", "PhysicsService", "TweenService",
        "Debris", "InsertService", "BadgeService", "DataStoreService",
        "GroupService", "MessagingService", "NetworkClient",
        "NetworkServer", "NotificationService", "SocialService",
        "FriendService", "GamePassService", "VoiceChatService",
        "LocalizationService", "AnalyticsService", "MemoryStoreService",
        "PolicyService", "SessionService", "HapticService", "AvatarService",
        "AdService", "CloudService", "GameService", "GeometryService",
        "PermissionsService", "PlayerEmulatorService", "ProximityPromptService",
        "RenderSettings", "ScriptContext", "ScriptService", "Stats",
        "TouchInputService", "VRService", "VirtualInputManager",
        "VirtualUser", "Visit"
    }) do
        local success, service = pcall(function()
            return game:GetService(serviceName)
        end)
        if success then
            env[serviceName] = service
        end
    end
    
    -- Fun√ß√£o print personalizada que mostra no output
    env.print = function(...)
        local args = {...}
        local output = ""
        for i, v in ipairs(args) do
            output = output .. (i > 1 and "\t" or "") .. tostring(v)
        end
        
        -- Mostra no output do executor
        AddToOutput(output, Color3.fromRGB(200, 200, 255))
        
        -- Tamb√©m mostra no output real do Roblox (opcional)
        print(output)
    end
    
    -- Atalhos
    env.p = env.print
    env.c = function(r, g, b) return Color3.new(r/255, g/255, b/255) end
    env.v3 = Vector3.new
    env.v2 = Vector2.new
    env.cf = CFrame.new
    env.ud2 = UDim2.new
    env.ud = UDim.new
    env.rgb = function(r, g, b) return Color3.new(r/255, g/255, b/255) end
    
    -- Loadstring customizado
    env.loadstring = CustomLoadString
    
    -- Fun√ß√£o para criar inst√¢ncias rapidamente
    env.New = function(className, properties)
        local instance = Instance.new(className)
        if properties then
            for prop, value in pairs(properties) do
                instance[prop] = value
            end
        end
        return instance
    end
    
    return env
end

-- Fun√ß√£o de execu√ß√£o principal
local function ExecuteCode()
    local code = CodeTextBox.Text
    
    -- Transforma atalho "=" em print
    if string.sub(code, 1, 1) == "=" then
        code = "print(" .. string.sub(code, 2) .. ")"
    end
    
    -- Limpa o output se estiver muito grande
    if #OutputText.Text > 10000 then
        OutputText.Text = "-- Output limpo por excesso de conte√∫do --\n"
    end
    
    -- Adiciona informa√ß√£o de execu√ß√£o no output
    AddToOutput("Executando c√≥digo...", Color3.fromRGB(150, 150, 255))
    
    -- Cria ambiente seguro
    local env = CreateExecutionEnvironment()
    
    -- Executa o c√≥digo
    local success, result = xpcall(function()
        local fn, err = CustomLoadString(code)
        if not fn then error(err or "Erro desconhecido ao compilar") end
        
        setfenv(fn, env)
        local results = {fn()}
        
        if #results > 0 then
            local output = ""
            for i, v in ipairs(results) do
                output = output .. (i > 1 and ", " or "") .. tostring(v)
            end
            return output
        end
        return "Execu√ß√£o conclu√≠da sem retorno"
    end, function(err)
        return tostring(err):gsub("^.+:%d+: ", "")
    end)
    
    -- Mostra resultado
    if success then
        AddToOutput(result, Color3.fromRGB(0, 255, 0))
    else
        AddToOutput(result, Color3.fromRGB(255, 50, 50))
    end
    
    SaveExecutorState(CodeTextBox.Text, MainFrame.Position, isMinimized, OutputText.Text)
end

ExecuteButton.MouseButton1Click:Connect(ExecuteCode)

-- Atalhos de teclado
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.F9 then
        ExecuteCode()
    end
    
    if input.KeyCode == Enum.KeyCode.Return and UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
        ExecuteCode()
    end
end)

-- Sistema de arrastar
local dragging = false
local dragStartPos
local startFramePos

MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStartPos = input.Position
        startFramePos = MainFrame.Position
        
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
                SaveExecutorState(CodeTextBox.Text, MainFrame.Position, isMinimized, OutputText.Text)
            end
        end)
    end
end)

UserInputService.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = input.Position - dragStartPos
        MainFrame.Position = UDim2.new(
            startFramePos.X.Scale, 
            startFramePos.X.Offset + delta.X,
            startFramePos.Y.Scale, 
            startFramePos.Y.Offset + delta.Y
        )
    end
end)

-- Fecha o executor e salva o estado
CloseButton.MouseButton1Click:Connect(function()
    SaveExecutorState(CodeTextBox.Text, MainFrame.Position, isMinimized, OutputText.Text)
    ScreenGui:Destroy()
end)

-- Focar no editor
task.defer(function()
    CodeTextBox:CaptureFocus()
end)

-- Restaura o estado minimizado se necess√°rio
if savedState and savedState.minimized then
    task.spawn(function()
        wait(0.1)
        if not isMinimized then
            ToggleMinimize()
        end
    end)
end

-- Mensagem inicial
AddToOutput("Kau√£ Executor ULTIMATE carregado!", Color3.fromRGB(100, 200, 255))
AddToOutput("Pronto para executar c√≥digo. Use F9 ou Ctrl+Enter.", Color3.fromRGB(200, 200, 200))
